import{S as i}from"./sweetalert2.all-448c5b76.js";import{_ as k,v as I,r as f,o as r,c as d,b as a,a as e,F as v,s as x,x as w,t as u,w as B,e as S,y as V,z as T,A as g,B as P}from"./index-8f8e701b.js";const{VITE_APP_URL:m,VITE_APP_PATH:h}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"azraelk",BASE_URL:"/weekk66",MODE:"production",DEV:!1,PROD:!0},L={data(){return{products:[],productId:"",cart:{},cartStatus:!1,isLoading:!1,loadingItem:"",user:{email:"",name:"",tel:"",address:""},message:""}},methods:{getCarts(){this.$http.get(`${m}/api/${h}/cart`).then(s=>{this.cart=s.data.data,this.cart.carts.length===0?this.cartStatus=!1:this.cartStatus=!0}).catch(s=>{console.error(s)})},updatedCartItem(s){const t={product_id:s.product.id,qty:s.qty};this.loadingItem=s.id,this.$http.put(`${m}/api/${h}/cart/${s.id}`,{data:t}).then(b=>{this.getCarts(),i.fire({position:"center",icon:"success",title:"產品數量已更新",showConfirmButton:!1,timer:1500}),this.loadingItem=""}).catch(b=>{console.error(b)})},delCartItem(s){this.loadingItem=s.id,this.$http.delete(`${m}/api/${h}/cart/${s.id}`).then(t=>{this.getCarts(),i.fire({position:"center",icon:"success",title:"成功刪除",showConfirmButton:!0,confirmButtonText:"確認"}),this.loadingItem=""}).catch(t=>{console.error(t)})},deleteAll(){i.fire({title:"確定要清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"取消"}).then(s=>{s.isConfirmed?I.delete(`${m}/api/${h}/carts`).then(()=>{this.getCarts(),i.fire({position:"center",icon:"success",title:"購物車已全部刪除",showConfirmButton:!0,confirmButtonText:"確認"})}).catch(t=>alert(t.response.data.message)):s.isDenied&&i.fire("留著好了","","info")})},changeLoading(s){this.loadingItem=s},onSubmit(){const s={user:this.user,message:this.message};if(this.cart.carts.length===0){alert("購物車內還沒有商品唷～");return}this.$http.post(`${m}/api/${h}/order`,{data:s}).then(t=>{i.fire({position:"center",icon:"success",title:"成功送出訂單",showConfirmButton:!0,confirmButtonText:"確認"}),this.$refs.form.resetForm(),this.getCarts(),this.message=""}).catch(t=>{alert(t.response.data.message)})},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"}},mounted(){this.getCarts(),this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},1e3)}},U={key:0,class:"text-center"},A=e("p",null,"購物車內還沒有商品，快去選購吧！",-1),E=[A],q={key:1,class:"container"},D={class:"text-end"},N=["disabled"],R={class:"table align-middle"},z=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",null,"圖片"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",{class:"text-end"},"單價"),e("th",{class:"text-end"},"小計")])],-1),F=["disabled","onClick"],M=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),H=["src"],O={class:"input-group input-group-sm"},$=["onUpdate:modelValue","disabled","onChange"],j=["value"],G={class:"text-end"},J={class:"text-end"},K=e("td",{colspan:"5",class:"text-end"},"總計",-1),Q={class:"text-end"},W={class:"my-5 row justify-content-center"},X={class:"mb-3"},Y=e("label",{for:"email",class:"form-label"},"Email",-1),Z={class:"mb-3"},ee=e("label",{for:"name",class:"form-label"},"姓名",-1),te={class:"mb-3"},se=e("label",{for:"tel",class:"form-label"},"電話",-1),oe={class:"mb-3"},le=e("label",{for:"address",class:"form-label"},"地址",-1),ne={class:"mb-3"},ae=e("label",{for:"message",class:"form-label"},"留言",-1),ie=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function re(s,t,b,de,o,c){const C=f("VueLoading"),_=f("v-field"),p=f("error-message"),y=f("v-form");return r(),d(v,null,[a(C,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=l=>o.isLoading=l)},null,8,["active"]),o.cartStatus?(r(),d("div",q,[e("div",D,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:!o.cartStatus,onClick:t[1]||(t[1]=l=>c.deleteAll())}," 清空購物車 ",8,N)]),e("table",R,[z,e("tbody",null,[o.cart.carts?(r(!0),d(v,{key:0},x(o.cart.carts,l=>(r(),d("tr",{key:l.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:l.id===o.loadingItem,onClick:n=>c.delCartItem(l)},[M,S(" x ")],8,F)]),e("td",null,u(l.product.title),1),e("td",null,[e("img",{src:l.product.imageUrl,width:"50",alt:""},null,8,H)]),e("td",null,[e("div",O,[V(e("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":n=>l.qty=n,disabled:l.id===o.loadingItem,onChange:n=>c.updatedCartItem(l)},[(r(),d(v,null,x(20,n=>e("option",{value:n,key:`${n}+'12345'`},u(n),9,j)),64))],40,$),[[T,l.qty]])])]),e("td",G,u(l.product.price),1),e("td",J,u(l.total),1)]))),128)):w("",!0)]),e("tfoot",null,[e("tr",null,[K,e("td",Q,u(o.cart.total),1)])])])])):(r(),d("div",U,E)),e("div",W,[a(y,{ref:"form",class:"col-md-6",onSubmit:c.onSubmit},{default:B(({errors:l})=>[e("div",X,[Y,a(_,{id:"email",name:"email",type:"email",class:g(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:o.user.email,"onUpdate:modelValue":t[2]||(t[2]=n=>o.user.email=n)},null,8,["class","modelValue"]),a(p,{name:"email",class:"invalid-feedback"})]),e("div",Z,[ee,a(_,{id:"name",name:"姓名",type:"text",class:g(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.user.name,"onUpdate:modelValue":t[3]||(t[3]=n=>o.user.name=n)},null,8,["class","modelValue"]),a(p,{name:"姓名",class:"invalid-feedback"})]),e("div",te,[se,a(_,{id:"tel",name:"電話",type:"tel",class:g(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:c.isPhone,modelValue:o.user.tel,"onUpdate:modelValue":t[4]||(t[4]=n=>o.user.tel=n)},null,8,["rules","class","modelValue"]),a(p,{name:"電話",class:"invalid-feedback"})]),e("div",oe,[le,a(_,{id:"address",name:"地址",type:"text",class:g(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.user.address,"onUpdate:modelValue":t[5]||(t[5]=n=>o.user.address=n)},null,8,["class","modelValue"]),a(p,{name:"地址",class:"invalid-feedback"})]),e("div",ne,[ae,V(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[6]||(t[6]=n=>o.user.message=n)},null,512),[[P,o.user.message]])]),ie]),_:1},8,["onSubmit"])])],64)}const me=k(L,[["render",re]]);export{me as default};
