import{S as l}from"./sweetalert2.all-09822ad0.js";import{_ as f,r as C,o as i,c as r,b,F as h,d as t,f as g,h as v,t as d,a as x,i as I,v as y}from"./index-4a4d3a3a.js";const{VITE_APP_URL:c,VITE_APP_PATH:u}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"azraelk",BASE_URL:"/weekk66/",MODE:"production",DEV:!1,PROD:!0},$={data(){return{products:[],productId:"",cart:{},cartStatus:!1,isLoading:!1,loadingItem:"",user:{email:"",name:"",tel:"",address:""},message:""}},methods:{getCarts(){this.$http.get(`${c}/api/${u}/cart`).then(e=>{this.cart=e.data.data,this.cart.carts.length===0?this.cartStatus=!1:this.cartStatus=!0}).catch(e=>{console.error(e)})},updatedCartItem(e){const s={product_id:e.product.id,qty:e.qty};this.loadingItem=e.id,this.$http.put(`${c}/api/${u}/cart/${e.id}`,{data:s}).then(p=>{this.getCarts(),l.fire({position:"center",icon:"success",title:"產品數量已更新",showConfirmButton:!1,timer:1500}),this.loadingItem=""}).catch(p=>{console.error(p)})},delCartItem(e){this.loadingItem=e.id,this.$http.delete(`${c}/api/${u}/cart/${e.id}`).then(s=>{this.getCarts(),l.fire({position:"center",icon:"success",title:"成功刪除",showConfirmButton:!0,confirmButtonText:"確認"}),this.loadingItem=""}).catch(s=>{console.error(s)})},deleteAll(){l.fire({title:"確定要清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"取消"}).then(s=>{s.isConfirmed?this.$https.Swal.fire("Saved!","","success"):s.isDenied&&l.fire("Changes are not saved","","info")})&&this.$https.delete`${c}/api/${u}/carts`.then(()=>{this.getCarts(),l.fire({position:"center",icon:"success",title:"購物車已全部刪除",showConfirmButton:!0,confirmButtonText:"確認"})}).catch(s=>alert(s.response.data.message))},changeLoading(e){this.loadingItem=e},onSubmit(){const e={user:this.user,message:this.message};if(this.cart.carts.length===0){alert("購物車內還沒有商品唷～");return}this.$http.post(`${c}/api/${u}/order`,{data:e}).then(s=>{alert(s.data.message),this.$refs.form.resetForm(),this.getCarts(),this.message=""}).catch(s=>{alert(s.response.data.message)})},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"需要正確的電話號碼"}},mounted(){this.getCarts(),this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},1e3)}},V={key:0,class:"text-center"},k=t("p",null,"購物車內還沒有商品，快去選購吧！",-1),S=[k],B={class:"text-end"},L=["disabled"],P={class:"table align-middle"},T=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",null,"圖片"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價"),t("th",{class:"text-end"},"小計")])],-1),w=["disabled","onClick"],A=t("i",{class:"fas fa-spinner fa-pulse"},null,-1),E=["src"],D={class:"input-group input-group-sm"},U=["onUpdate:modelValue","disabled","onChange"],N=["value"],q={class:"text-end"},R={class:"text-end"},F=t("td",{colspan:"5",class:"text-end"},"總計",-1),H={class:"text-end"};function M(e,s,p,O,o,_){const m=C("VueLoading");return i(),r(h,null,[b(m,{active:o.isLoading,"onUpdate:active":s[0]||(s[0]=n=>o.isLoading=n)},null,8,["active"]),o.cartStatus?(i(),r(h,{key:1},[t("div",B,[t("button",{class:"btn btn-outline-danger",type:"button",disabled:!o.cartStatus,onClick:s[1]||(s[1]=n=>_.deleteAll())}," 清空購物車 ",8,L)]),t("table",P,[T,t("tbody",null,[o.cart.carts?(i(!0),r(h,{key:0},g(o.cart.carts,n=>(i(),r("tr",{key:n.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:n.id===o.loadingItem,onClick:a=>_.delCartItem(n)},[A,x(" x ")],8,w)]),t("td",null,d(n.product.title),1),t("td",null,[t("img",{src:n.product.imageUrl,width:"50",alt:""},null,8,E)]),t("td",null,[t("div",D,[I(t("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":a=>n.qty=a,disabled:n.id===o.loadingItem,onChange:a=>_.updatedCartItem(n)},[(i(),r(h,null,g(20,a=>t("option",{value:a,key:"i+'12345'"},d(a),9,N)),64))],40,U),[[y,n.qty]])])]),t("td",q,d(n.product.price),1),t("td",R,d(n.total),1)]))),128)):v("",!0)]),t("tfoot",null,[t("tr",null,[F,t("td",H,d(o.cart.total),1)])])])],64)):(i(),r("div",V,S))],64)}const G=f($,[["render",M]]);export{G as default};
