import{S as m}from"./sweetalert2.all-322d9af8.js";import{_ as v,o as i,c as n,b as e,A as U,B as k,F as P,z as w,t as _,E as d,J as u,K as x,f as $,r as p,d as g}from"./index-ce17c2e9.js";import{M as C}from"./modal-0f7d7d6b.js";const L={props:["pagination"],data(){return{}},methods:{changePage(a){this.$emit("changePage",a)}}},T={"aria-label":"Page navigation"},A={class:"pagination d-flex justify-content-center"},E=e("span",{"aria-hidden":"true"},"«",-1),D=[E],B=["onClick"],R=e("span",{"aria-hidden":"true"},"»",-1),F=[R];function N(a,t,l,y,r,s){return i(),n("nav",T,[e("ul",A,[e("li",{class:U(["page-item",{disabled:!l.pagination.has_pre}])},[e("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=k(o=>s.changePage(l.pagination.current_page-1),["prevent"])),"aria-label":"Previous"},D)],2),(i(!0),n(P,null,w(l.pagination.total_pages,o=>(i(),n("li",{class:U(`page-item ${o===l.pagination.current_page?"active":""}`),key:o+"page"},[e("a",{class:"page-link",href:"#",onClick:k(h=>s.changePage(o),["prevent"])},_(o),9,B)],2))),128)),e("li",{class:U(["page-item",{disabled:!l.pagination.has_next}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=k(o=>s.changePage(l.pagination.current_page+1),["prevent"])),"aria-label":"Next"},F)],2)])])}const S=v(L,[["render",N]]),{VITE_APP_URL:H,VITE_APP_PATH:O}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"azraelk",BASE_URL:"/weekk66",MODE:"production",DEV:!1,PROD:!0},z={props:["tempProduct","operateType"],emits:["saveProduct"],data(){return{productModal:""}},methods:{createImagesUrl(){this.innerProduct.imagesUrl||(this.innerProduct.imagesUrl=[]),this.innerProduct.imagesUrl.push("")},deleteImagesUrl(){this.innerProduct.imagesUrl.pop()},showModal(){this.productModal.show()},hideModal(){this.productModal.hide()},uploadFile(){const a=new FormData;a.append("file-to-upload",this.$refs.fileInput.files[0]);const t=`${H}/api/${O}/admin/upload`;m.fire({title:"上傳圖片中",timer:2e3,timerProgressBar:!0,didOpen:()=>{m.showLoading()},willClose:()=>{this.$http.post(t,a,{headers:{"Content-Type":"multipart/form-data"}}).then(l=>{l.data.success&&(this.innerProduct.imageUrl=l.data.imageUrl),this.$refs.fileInput.value=""}).catch(l=>{m.fire({icon:"error",title:l.response.data.message}),this.$refs.fileInput.value=""})}})}},mounted(){this.productModal=new C(this.$refs.productModal,{keyboard:!1})},computed:{innerProduct(){return this.tempProduct}}},j={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},J={class:"modal-dialog modal-xl"},K={class:"modal-content border-0"},q={class:"modal-header bg-dark text-white"},G={id:"productModalLabel",class:"modal-title"},Q={key:0},W={key:1},X=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},Z={class:"row"},ee={class:"col-sm-4"},te={class:"mb-2"},se={class:"mb-3"},oe=e("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),ae={class:"mb-3"},le=e("label",{for:"uploadFile",class:"form-label"},"或 上傳圖片",-1),ie=["src"],ne=e("h3",{class:"mb-3"},"多圖新增",-1),de=e("label",{for:"imagesUrl",class:"form-label"},"圖片網址",-1),re=["onUpdate:modelValue"],ce=["src"],ue={key:0},me={key:1},he={class:"col-sm-8"},_e={class:"mb-3"},pe=e("label",{for:"title",class:"form-label"},"標題",-1),ge={class:"row"},be={class:"mb-3 col-md-6"},fe=e("label",{for:"category",class:"form-label"},"分類",-1),Pe={class:"mb-3 col-md-6"},ve=e("label",{for:"price",class:"form-label"},"單位",-1),ye={class:"row"},Me={class:"mb-3 col-md-6"},Ue=e("label",{for:"origin_price",class:"form-label"},"原價",-1),ke={class:"mb-3 col-md-6"},we=e("label",{for:"price",class:"form-label"},"售價",-1),$e=e("hr",null,null,-1),Ce={class:"mb-3"},Ve=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ie={class:"mb-3"},xe=e("label",{for:"content",class:"form-label"},"說明內容",-1),Le={class:"mb-3"},Te={class:"form-check"},Ae=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ee={class:"modal-footer"},De=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Be(a,t,l,y,r,s){return i(),n("div",j,[e("div",J,[e("div",K,[e("div",q,[e("h5",G,[l.operateType==="create"?(i(),n("span",Q,"新增產品")):(i(),n("span",W,"編輯產品"))]),X]),e("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[e("div",se,[oe,d(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結",id:"imageUrl","onUpdate:modelValue":t[0]||(t[0]=o=>s.innerProduct.imageUrl=o)},null,512),[[u,s.innerProduct.imageUrl]])]),e("div",ae,[le,e("input",{type:"file",id:"uploadFile",class:"form-control",ref:"fileInput",onChange:t[1]||(t[1]=(...o)=>s.uploadFile&&s.uploadFile(...o))},null,544)]),e("img",{class:"img-fluid",src:s.innerProduct.imageUrl},null,8,ie)]),ne,(i(!0),n(P,null,w(s.innerProduct.imagesUrl,(o,h)=>(i(),n("div",{class:"mb-3",key:h},[de,d(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結",id:"imagesUrl","onUpdate:modelValue":M=>s.innerProduct.imagesUrl[h]=M},null,8,re),[[u,s.innerProduct.imagesUrl[h]]]),e("img",{class:"img-fluid",src:s.innerProduct.imagesUrl[h]},null,8,ce)]))),128)),!s.innerProduct.imagesUrl||!s.innerProduct.imagesUrl.length||s.innerProduct.imagesUrl[s.innerProduct.imagesUrl.length-1]?(i(),n("div",ue,[e("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[2]||(t[2]=(...o)=>s.createImagesUrl&&s.createImagesUrl(...o))}," 新增圖片 ")])):(i(),n("div",me,[e("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:t[3]||(t[3]=(...o)=>s.deleteImagesUrl&&s.deleteImagesUrl(...o))}," 刪除圖片 ")]))]),e("div",he,[e("div",_e,[pe,d(e("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[4]||(t[4]=o=>s.innerProduct.title=o)},null,512),[[u,s.innerProduct.title]])]),e("div",ge,[e("div",be,[fe,d(e("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":t[5]||(t[5]=o=>s.innerProduct.category=o)},null,512),[[u,s.innerProduct.category]])]),e("div",Pe,[ve,d(e("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":t[6]||(t[6]=o=>s.innerProduct.unit=o)},null,512),[[u,s.innerProduct.unit]])])]),e("div",ye,[e("div",Me,[Ue,d(e("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":t[7]||(t[7]=o=>s.innerProduct.origin_price=o)},null,512),[[u,s.innerProduct.origin_price,void 0,{number:!0}]])]),e("div",ke,[we,d(e("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":t[8]||(t[8]=o=>s.innerProduct.price=o)},null,512),[[u,s.innerProduct.price,void 0,{number:!0}]])])]),$e,e("div",Ce,[Ve,d(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[9]||(t[9]=o=>s.innerProduct.description=o)},`
                `,512),[[u,s.innerProduct.description]])]),e("div",Ie,[xe,d(e("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":t[10]||(t[10]=o=>s.innerProduct.content=o)},`
                `,512),[[u,s.innerProduct.content]])]),e("div",Le,[e("div",Te,[d(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[11]||(t[11]=o=>s.innerProduct.is_enabled=o)},null,512),[[x,s.innerProduct.is_enabled]]),Ae])])])])]),e("div",Ee,[De,e("button",{type:"button",class:"btn btn-primary",onClick:t[12]||(t[12]=o=>a.$emit("saveProduct",s.innerProduct))}," 確認 ")])])])],512)}const Re=v(z,[["render",Be]]),Fe={props:["tempItem"],emits:["deleteItem"],data(){return{delModal:""}},methods:{showModal(){this.delModal.show()},hideModal(){this.delModal.hide()}},mounted(){this.delModal=new C(this.$refs.delModal,{keyboard:!1})}},Ne={id:"delModal",ref:"delModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delModalLabel","aria-hidden":"true"},Se={class:"modal-dialog"},He={class:"modal-content border-0"},Oe={class:"modal-header bg-danger text-white"},ze={id:"delModalLabel",class:"modal-title"},je=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Je={class:"modal-body"},Ke={class:"text-danger"},qe={class:"modal-footer"},Ge=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Qe(a,t,l,y,r,s){return i(),n("div",Ne,[e("div",Se,[e("div",He,[e("div",Oe,[e("h5",ze,[e("span",null,"刪除 "+_(l.tempItem.title),1)]),je]),e("div",Je,[$(" 是否刪除 "),e("strong",Ke,_(l.tempItem.title),1),$(" (刪除後將無法恢復)。 ")]),e("div",qe,[Ge,e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=o=>a.$emit("deleteItem"))}," 確認刪除 ")])])])],512)}const We=v(Fe,[["render",Qe]]),{VITE_APP_URL:b,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"azraelk",BASE_URL:"/weekk66",MODE:"production",DEV:!1,PROD:!0},Xe={data(){return{isLoading:!1,products:[],operateType:"",tempProduct:{imagesUrl:[]},pagination:{},pageNum:1}},methods:{getProducts(a=1){this.isLoading=!0,this.pageNum=a,this.$http.get(`${b}/api/${f}/admin/products?page=${a}`).then(t=>{this.products=t.data.products,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{m.fire({icon:"error",title:t.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},saveProduct(a){this.isLoading=!0;let t=`${b}/api/${f}/admin/product`;this.operateType==="modify"&&(t=`${b}/api/${f}/admin/product/${a.id}`),this.$http[this.operateType==="create"?"post":"put"](`${t}`,{data:a}).then(l=>{this.$refs.productModal.hideModal(),m.fire({icon:"success",title:l.data.message,showConfirmButton:!1,timer:1500}),this.getProducts(this.pageNum),this.isLoading=!1}).catch(l=>{m.fire({icon:"error",title:l.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},deleteProduct(){this.isLoading=!0,this.$http.delete(`${b}/api/${f}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(a=>{this.$refs.delModal.hideModal(),m.fire({icon:"success",title:a.data.message,showConfirmButton:!1,timer:1500}),this.getProducts(this.pageNum),this.isLoading=!1}).catch(a=>{m.fire({icon:"error",title:a.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(a,t){this.operateType=a,a==="create"?(this.tempProduct={imagesUrl:[]},this.$refs.productModal.showModal()):a==="modify"?(this.tempProduct={...t},this.$refs.productModal.showModal()):a==="delete"&&(this.tempProduct={...t},this.$refs.delModal.showModal())}},components:{PaginationComponent:S,ProductModal:Re,DelModal:We},mounted(){this.getProducts()}},Ye={class:"container"},Ze={class:"text-end mt-4"},et={class:"table table-hover mt-4"},tt=e("thead",null,[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120"},"原價"),e("th",{width:"120"},"售價"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),st={class:"text-end"},ot={class:"text-end"},at={key:0,class:"text-success"},lt={key:1},it={class:"btn-group"},nt=["onClick"],dt=["onClick"];function rt(a,t,l,y,r,s){const o=p("VueLoading"),h=p("PaginationComponent"),M=p("ProductModal"),V=p("DelModal");return i(),n(P,null,[g(o,{active:r.isLoading},null,8,["active"]),e("div",Ye,[e("div",Ze,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=c=>s.openModal("create"))}," 建立新的產品 ")]),e("table",et,[tt,e("tbody",null,[(i(!0),n(P,null,w(r.products,c=>(i(),n("tr",{key:c.id},[e("td",null,_(c.category),1),e("td",null,_(c.title),1),e("td",st,_(c.origin_price),1),e("td",ot,_(c.price),1),e("td",null,[c.is_enabled?(i(),n("span",at,"啟用")):(i(),n("span",lt,"未啟用"))]),e("td",null,[e("div",it,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:I=>s.openModal("modify",c)}," 編輯 ",8,nt),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:I=>s.openModal("delete",c)}," 刪除 ",8,dt)])])]))),128))])]),g(h,{pagination:r.pagination,onChangePage:s.getProducts},null,8,["pagination","onChangePage"])]),g(M,{ref:"productModal","temp-product":r.tempProduct,"operate-type":r.operateType,onSaveProduct:s.saveProduct},null,8,["temp-product","operate-type","onSaveProduct"]),g(V,{ref:"delModal","temp-item":r.tempProduct,onDeleteItem:s.deleteProduct},null,8,["temp-item","onDeleteItem"])],64)}const ht=v(Xe,[["render",rt]]);export{ht as default};
